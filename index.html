<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Pendataan UTTP Kota Tasikmalaya</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    #map { height: 400px; }
  </style>
</head>
<body class="container py-4">
  <h2 class="mb-4">Form Pendataan UTTP</h2>
  
  <form id="uttpForm">
    <div class="row mb-3">
      <div class="col"><input class="form-control" id="jenis" placeholder="Jenis UTTP" required></div>
      <div class="col"><input class="form-control" id="merk" placeholder="Merk" required></div>
    </div>
    <div class="row mb-3">
      <div class="col"><input class="form-control" id="model" placeholder="Model/Tipe" required></div>
      <div class="col"><input class="form-control" id="nomorSeri" placeholder="Nomor Seri" required></div>
    </div>
    <div class="row mb-3">
      <div class="col"><input type="date" class="form-control" id="tanggalTera" required></div>
      <div class="col"><input class="form-control" id="namaPemilik" placeholder="Nama Pemilik" required></div>
    </div>
    <div class="mb-3">
      <input class="form-control" id="lokasi" placeholder="Koordinat Lokasi (contoh: -7.3278,108.2206)" required>
    </div>
    <button type="submit" class="btn btn-primary">Simpan Data</button>
  </form>

  <h4 class="mt-5">Peta Lokasi</h4>
  <div id="map" class="border rounded"></div>

  <script>
    const form = document.getElementById("uttpForm");
    const mapElement = document.getElementById("map");
    let map, marker;

    form.addEventListener("submit", function(e) {
      e.preventDefault();

      const data = {
        jenis: jenis.value,
        merk: merk.value,
        model: model.value,
        nomorSeri: nomorSeri.value,
        tanggalTera: tanggalTera.value,
        namaPemilik: namaPemilik.value,
        lokasi: lokasi.value
      };

      fetch("https://script.google.com/macros/s/AKfycbzn1wMxMNq9wTc5kOCT6Q6Igr0_Q0NqKHFB1Q423oiXCyTTnzsJt4w7MiALgrryVh-8/exec", {
        method: "POST",
        body: JSON.stringify(data),
        headers: { "Content-Type": "application/json" }
      })
      .then(res => res.text())
      .then(result => {
        alert("Data berhasil disimpan");
        tampilkanPeta(data.lokasi);
        form.reset();
      })
      .catch(err => alert("Gagal menyimpan data: " + err));
    });

    function tampilkanPeta(lokasiString) {
      const [lat, lng] = lokasiString.split(",").map(Number);
      const posisi = { lat, lng };

      if (!map) {
        map = new google.maps.Map(mapElement, {
          zoom: 15,
          center: posisi
        });
        marker = new google.maps.Marker({ position: posisi, map });
      } else {
        map.setCenter(posisi);
        marker.setPosition(posisi);
      }
    }
  </script>

  <script async
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCtI4I8JcZHCFLXJQzG4koKUvKQzqERPdc&callback=initMap">
  </script>
  <script>
    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: -7.35, lng: 108.2 },
        zoom: 12
      });
    }
  </script>
</body>
</html>
